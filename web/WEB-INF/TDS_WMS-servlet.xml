<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : WMS-servlet.xml
    Created on : 06 June 2007, 17:59
    Author     : Jon
    Description:
        Configuration for a THREDDS WMS.
-->

<beans xmlns='http://www.springframework.org/schema/beans'
       xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
       xsi:schemaLocation='http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd'>
    
    <!-- Configuration of this ncWMS server. -->
    <bean id="config" class="uk.ac.rdg.resc.ncwms.thredds.ThreddsServerConfig"/>
    
    <!-- This Controller will handle all the requests to the WMS -->
    <bean id="wmsController" class="uk.ac.rdg.resc.ncwms.controller.WmsController"
            init-method="init">
        <property name="supportedMethods" value="GET"/>
        <property name="serverConfig"><ref local="config"/></property>
    </bean>
    
    <!-- This mapping ensures that all requests to "/wms" are mapped to the WmsController
         and "index.jsp" results in the display of the front page -->
    <!-- no 'id' required, HandlerMapping beans are automatically detected by the DispatcherServlet -->
    <bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="alwaysUseFullPath" value="true"/>
        <property name="mappings">
            <value>
                /wms = wmsController
            </value>
        </property>
    </bean>
    
    <!-- Each Controller will return the name of a View that maps to a certain JSP.
         For example, if a Controller returns a View name "hello_xml", the 
         ViewResolver will display /WEB-INF/jsp/hello_xml.jsp. -->
    <bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <!-- We put the JSPs in /WEB-INF so that they are not directly visible 
             over the network -->
        <property name="prefix" value="/WEB-INF/jsp/"/>
        <property name="suffix" value=".jsp"/>
    </bean>
    
    <!-- Exception Handling: this ensures that all WmsExceptions are returned to 
         the user as an XML document, created by displayWmsException.jsp.
         Note that we don't have to register this anywhere as an exception handler
         because Spring automagically detects it. -->
    <bean id="exceptionResolver" class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
        <property name="exceptionMappings">
            <props>
                <prop key="uk.ac.rdg.resc.ncwms.exceptions.WmsException">displayWmsException</prop>
                <prop key="uk.ac.rdg.resc.ncwms.exceptions.Wms1_1_1Exception">displayWms1_1_1Exception</prop>
                <prop key="uk.ac.rdg.resc.ncwms.exceptions.MetadataException">displayMetadataException</prop>
            </props>
        </property>
        <!-- If an unexpected error occurs (i.e. one that doesn't get expressed as
             a WmsException) we will handle it using displayDefaultException.jsp -->
        <property name="defaultErrorView" value="displayDefaultException"/>
    </bean>
    
</beans>
